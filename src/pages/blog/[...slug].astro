---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Menggunakan Astro.request.url untuk mendapatkan URL saat ini
const currentUrl = new URL(Astro.request.url);
const shareUrl = currentUrl.href;

// Fungsi untuk mengenkode URL dan teks untuk berbagi
function encodeShareUrl(url: string, text: string) {
  return encodeURIComponent(`${text} ${url}`);
}
---

<Layout title={entry.data.title}>
  <header class="bg-gray-800 text-white">
    <Navbar />
</header>
  <article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12 font-sora">
    {entry.data.thumbnail && (
      <img 
        src={entry.data.thumbnail}
        alt={entry.data.title}
        class="w-full h-64 object-cover rounded-lg shadow-lg mb-8"
      />
    )}
    <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-50 mb-4">
      {entry.data.title}
    </h1>
    <div class="flex items-center text-gray-600 dark:text-gray-400 mb-4">
      <span>{entry.data.author}</span>
      <span class="mx-2">â€¢</span>
      <time datetime={entry.data.pubDate.toISOString()}>
        {new Date(entry.data.pubDate).toLocaleDateString()}
      </time>
    </div>
    <div class="flex flex-wrap gap-4 mb-8">
      <a 
        href={`https://wa.me/?text=${encodeShareUrl(shareUrl, entry.data.title)}`}
        target="_blank"
        rel="noopener noreferrer"
        class="bg-green-500 text-white px-4 py-2 rounded-full hover:bg-green-600 transition duration-300"
      >
        Share on WhatsApp
      </a>
      <a 
        href={`https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(entry.data.title)}`}
        target="_blank"
        rel="noopener noreferrer"
        class="bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 transition duration-300"
      >
        Share on Telegram
      </a>
      <a 
        href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`}
        target="_blank"
        rel="noopener noreferrer"
        class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 transition duration-300"
      >
        Share on Facebook
      </a>
      <a 
        href={`https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(entry.data.title)}`}
        target="_blank"
        rel="noopener noreferrer"
        class="bg-black text-white px-4 py-2 rounded-full hover:bg-gray-800 transition duration-300"
      >
        Share on X
      </a>
    </div>
    <div class="prose dark:prose-invert max-w-none">
      <Content />
    </div>
  </article>
</Layout>